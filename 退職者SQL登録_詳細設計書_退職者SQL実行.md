## 退職者SQL実行			
プログラムID:dbpro03			
			
## 環境部			
### 入出力節			
### ファイル管理段落			
・人事部ファイルを/home/suzuki/DATA/JINJI2007とのファイルの対応を宣言する。			

・順ファイルの入出力状態(人事状態)を宣言する。			

・総務部ファイルを/home/suzuki/DATA/SOUMU2007とのファイルの対応を宣言する。			

・順ファイルの入出力状態(総務状態)を宣言する。			

・退職者ファイルを/home/suzuki/DATA/TAISYOKU2007とのファイルの対応を宣言する。			

・順ファイルの入出力状態(退職状態)を宣言する。			
			
## データ部			
### ファイル節			
人事部ファイルをファイル節に記述する。			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|人事部レコード|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|備考|
|---|---|---|
|氏名|40(Xタイプ)|-|		
|年齢|2(9タイプ)|-|		
			
総務部ファイルをファイル節に記述する。			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|総務部レコード|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|備考|
|---|---|---|
|氏名|40(Xタイプ)|-|		
|年齢|2(9タイプ)|-|		
			
退職者ファイルをファイル節に記述する。			
集団項目(レベル番号01)			

|項目名|桁数|備考|
|---|---|---|
|退職者レコード|51(Xタイプ)|-|		
			
			
### 作業場所節			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|状態|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|
|---|---|
|人事状態|2(Xタイプ)|		
|総務状態|2(Xタイプ)|		
|退職状態|2(Xタイプ)|		
			
集団項目(レベル番号01)			

|項目名|設定値|		
|カウンタ|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|
|---|---|
|人事カウンタ|2(9タイプ)|		
|総務カウンタ|2(9タイプ)|		
			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|社員情報|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|設定値|備考|
|---|---|---|---|
|部署|-|-|2回繰り返す。指標名は「K」|
			
基本項目(レベル番号05)			

|項目名|桁数|設定値|備考|
|---|---|---|---|
|従業員|-|-|30回繰り返す。指標名は「L」|
			
基本項目(レベル番号10)			

|項目名|桁数|設定値|
|---|---|---|
|氏名|40(Xタイプ)|-|	
|年齢|2(9タイプ)|-|	
			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|表示データ|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|設定値|備考|
|---|---|---|---|
|退職者|-|-|60回繰り返す。指標名は「A1」、「A2」|
			
基本項目(レベル番号05)			

|項目名|桁数|設定値|
|---|---|---|---|
|部|1(9タイプ)|-|	
|社員ナンバー|2(9タイプ)|-|	
|名前|40(Xタイプ)|-|	
			
基本項目(レベル番号03)			

|項目名|桁数|設定値|
|---|---|---|
|部表示|7(Xタイプ)|-|	
			
集団項目(レベル番号01)			

|項目名|桁数|		
|---|---|
|件数|2(9タイプ)|		
			
基本項目(レベル番号88)			

|項目名|設定値|
|---|---|
|印刷実行|ZERO|		
|改ページ|10|		
			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|退避レコード|-|		
			
基本項目(レベル番号03)			

|項目名|桁数|備考|
|---|---|---|
|部署|40(Xタイプ)|-|		
|カンマ１|1(Xタイプ)|-|		
|社員番号|2(9タイプ)|-|		
|カンマ１|1(Xタイプ)|-|		
|氏名|40(Xタイプ)|-|		
			
### 1.ホスト変数の定義			
埋込SQL宣言節			
集団項目(レベル番号01)			

|項目名|桁数|設定値|
|---|---|---|
|DBNAME|10(Xタイプ)|mydb|	
|USERNAME|10(Xタイプ)|suzuki|	
|PASSWORD|10(Xタイプ)|yudai103|	
			
集団項目(レベル番号01)			

|項目名|桁数|設定値|
|---|---|---|
|SW-AREA|-|-|	
			
基本項目(レベル番号03)			

|項目名|桁数|設定値|
|---|---|---|
|SW-NOTFOUND|1(Xタイプ)|SPACE|	
			
集団項目(レベル番号01)			

|項目名|桁数|設定値|
|---|---|---|
|CST-AREA|-|-|	
			
基本項目(レベル番号03)			

|項目名|桁数|設定値|
|---|---|---|
|CST-1X|1(Xタイプ)|1|	
|CST-SQL-NF|5(S9タイプ)|+100|	
			
集団項目(レベル番号01)			

|項目名|設定値|
|---|---|
|SYAININFO|-|		
			
集団項目(レベル番号05)			

|項目名|桁数|設定値|
|---|---|---|
|BUSYO|7(Xタイプ)|-|	
|SYAINBANGOU|2(9タイプ)|-|	
|NAME|40(Xタイプ)|-|	
			
### 2.共通領域の定義			
SQLCAをイクードする。			
			
## 手続き部			
## 開始セクション			
			
### 1.初期処理へ			
			
### 2.主処理へ			
			
### 3.終了処理へ			
			
## 1.初期処理			
ワーク初期化			
カウンタ、社員情報、表示データをそれぞれ初期化する。			
			
### 3.ファイルOPEN			
人事ファイルを入力ファイルで開く。			
総務ファイルを入力ファイルで開く。			
退職者ファイルを出力ファイルで開く。			
・人事状態または総務状態または退職状態が 00の場合			
処理しない			
・それ以外の場合			
人事部ファイルを閉じる。			
総務部ファイルを閉じる。			
退職者ファイルを閉じる。			
オープンエラー。			
プログラムを終了させる。			
			
データベースと接続			
USERNAMEとPASSWORDとDBNAMEで接続する。			
			
全件削除			
taisyokusyaテーブルを全件削除する。			
SQLコードを表示する。			
			
全件削除をコミットする。			
コミットする。			
			
## 2.主処理			
			
### 2.1.人事部ファイル読み込みへ			
			
### 2.2.総務部ファイル読み込みへ			
			
### 2.3.初期化・検索へ			
			
## 2.1.人事部ファイル読み込み			
1を人事カウンタに設定。			
人事状態が00でなくなるまでループ処理をする。			
人事部ファイルを読み込む			
読み込み完了時			
処理をやめる。			
			
読み込み時			
氏名 OF 人事部レコードを氏名 OF 社員情報(1,人事カウンタ)に設定する。			
年齢 OF 人事部レコードを年齢 OF 社員情報(1,人事カウンタ)に設定する。			
人事カウンタに1を加える設定。			
試験結果基本 OF 試験結果レコードをSHIKENKEKKA1に設定する。			
			
## 2.2.総務部ファイル読み込み			
1を総務カウンタに設定。			
総務状態が00でなくなるまでループ処理をする。			
総務部ファイルを読み込む			
読み込み完了時			
処理をやめる。			
			
読み込み時			
氏名 OF 総務部レコードを氏名 OF 社員情報(2,人事カウンタ)に設定する。			
年齢 OF 総務部レコードを年齢 OF 社員情報(2,人事カウンタ)に設定する。			
総務カウンタに1を加える設定。			
			
## 2.3.初期化・検索			
A1をZEROに設定する。			
指標Kを１に設定する。			
Kが2を超えるまでループ処理する。			
指標Lを１に設定する。			
Lが30を超えるまでループ処理する。			
従業員に関してSEARCHを実施する			
それ以外の時			
     何も処理しない。			
・年齢(K) OF 社員情報(K,L) = 60の時			
     A1を1加算する。			
     Kに部(A1)を設定。			
     Lに社員ナンバー(A1)を設定。			
     氏名 OF 社員情報 (K,L)を名前(A1)に設定			
     Lを1加算する。			
     SEARCH文終了			
     Kを1加算する。			
    ループ処理終了			
    改ページを設定する。			
			
## 2.4.退職者表示			
			
A1がZEROの時			
該当者なしを表示。			
A1がZERO以外の時			
A2を初期値1、増分値１でA1を超えるまでループ処理させる。			
   ・部(A2)が1の時			
     "JINJIBU" を部表示に設定する。			
   ・それ以外の時			
      "SOUMUBU"を部表示に設定する。			
     部表示 "," 社員ナンバー(A2) ","名前(A2)を表示する。			
    ・改ページの時			
       タイトルからAFTER PAGE指定で退職レコードに書き込む。			
       印刷実行に設定する。			
    ・それ以外の時			
       処理をやめる。			
     退避レコードを初期化する。			
     部表示を部署 OF 退避レコードに設定する。			
     ”,”をカンマ１ OF 退避レコードに設定する。			
     社員ナンバー(A2)を社員番号 OF 退避レコードに設定する。			
     ”,”をカンマ２ OF 退避レコードに設定する。			
     名前(A2)を氏名 OF 退避レコードに設定する。			
     退避レコードから1行空白で退職レコードに書き込む。			
     件数を1加算する。			
     部表示をBUSYOに設定する。			
     社員ナンバー(A2)をSYAINBANGOUに設定する。			
     名前(A2)をNAMEに設定する。			
     taisyokusyaレコードに列BUSYO,SYAINBANGOU,NAMEで挿入する。			
     SQLコードを表示する。			
     コミットする。			
     ループ処理終了する。			
			
## 2.5.オープンリターン処理			
カーソルオープン処理を表示する。			
カーソル名CSR01でtaisyokusyaテーブルをbusyo,syainbangou,nameに対してSELECT文を定義する。			
			
カーソル名CSR01を開く。			
			
## 2.6.フェッチリターン処理			
FETCH-RTNに対して、SW-NOTFOUND = CST-1Xになるまでループ処理を繰り返す			
FETCH処理を表示する。			
JUKENBI、JUKENSHAIDに対してカーソル名CSR01でフェッチ文を実行する。			
SQLCODE = CST-SQL-NFの時			
CST-1XをSW-NOTFOUNDに設定する。			
SQLCODEを表示する。			
			
SQLCODE = CST-SQL-NF以外の時			
"部署:" BUSYO、"社員番号:" SYAINBANGOU、"名前:" NAMEを表示する。			
			
## 2.7.クローズリターン処理			
カーソルクローズ処理を表示する。			
カーソル名CSR01をクローズ処理する。			
			
## 3.終了処理			
人事部ファイル、総務部ファイル、退職者ファイルをクローズする。			
